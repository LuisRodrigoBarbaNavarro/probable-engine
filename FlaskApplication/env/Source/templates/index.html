<!DOCTYPE html>
<html>

<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.1.2/socket.io.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    @media (max-width: 576px) {
      .mobile-padding {
        padding-left: 10px;
        padding-right: 10px;
      }
    }

    body {
      background-color: #343a40;
      padding: 40px;
      color: white;
      align-content: center;
    }

    .container {
      background-color: #343a40;
      border-radius: 20px;
      padding: 20px;
      box-shadow: 5px 5px 10px rgba(0, 0, 0, 0.5),
        -5px -5px 10px rgba(255, 255, 255, 0.05);
    }
  </style>
  <script>
    socket = io()
    socket.connect('http://localhost:5000')

    socket.on('connect', (data) => {
      console.log("Connected")
      socket.send('Hello')
    })

    socket.on('message', (data) => {
      console.log("Sensor Data: " + data)
      var value = parseInt(data);

      if (isNaN(value)) {
        // Reset the progress bar if the input is not a number
        value = 0;
      } else {
        // Ensure the input value stays within the range of 90 to 200
        value = Math.max(90, Math.min(value, 200));
      }

      var normalizedValue = (value - 90) / (200 - 90) * 100;

      $('.progress-bar').css('width', normalizedValue + '%');
      $('.progress-bar').css('background-color', getColorForValue(normalizedValue));
      $('.progress-bar').attr('aria-valuenow', normalizedValue);

      function getColorForValue(value) {
        var red = Math.round(255 * (1 - value / 100));
        var green = Math.round(255 * (value / 100));
        var blue = 0;
        return 'rgb(' + green + ', ' + red + ', ' + blue + ')';
      }

      socket.send('Hello')
    })
  </script>
</head>

<body>
  <div class="container text-center mobile-padding">
    <div class="row">
      <div class="col">
        <div class="container text-center mobile-padding">
          <h3>Sensor Light</h1>
            <hr color="white">
            <div class="progress">
              <div class="progress-bar" role="progressbar" style="width: 0%; background-color: green;" aria-valuenow="0"
                aria-valuemin="0" aria-valuemax="100"></div>
            </div>
        </div>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col">
        <div class="container text-center mobile-padding">
          <h3>Data</h3>
          <hr color="white">
        </div>
      </div>
      <div class="col">
        <div class="container text-center mobile-padding">
          <h3>Issues</h3>
          <hr color="white">
        </div>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col">
        <div class="container text-center mobile-padding">
          <h3>Realtime Chart</h3>
          <hr color="white">
          <div id="chart"></div>
          <script>
            function getData() {
              return Math.random();
            }

            Plotly.plot('chart', [{
              y: [getData()],
              type: 'line'
            }]);

            var cnt = 0;

            setInterval(function () {

              Plotly.extendTraces('chart', { y: [[getData()]] }, [0]);
              cnt++;
              if (cnt > 500) {
                Plotly.relayout('chart', {
                  xaxis: {
                    range: [cnt - 500, cnt]
                  }
                });
              }
            }, 15);
          </script>
        </div>
      </div>
    </div>

    <div>
      <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.10.2/dist/umd/popper.min.js"></script>
      <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>